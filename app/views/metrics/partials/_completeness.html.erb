<div class="analysis pill-pane active">
  <%= render partial: 'shared/record_selector' %>
  <div class="dashboard row">
    <div class="col-md-12">
      <table class="table table-bordered completeness-table">
        <thead>
          <tr>
            <th>Field</th>
            <th>Subfield</th>
            <% 2.times do |i| %>
              <th><%= @documents[i].record[:name] %></th>
            <% end %>
          </tr>
        </thead>
        <tbody>
          <% @analysis[:properties].each do |field| %>
            <% if field.is_a?(Array) %>
              <% subfields = field[1..-1] %>
              <% field = field.first %>
              <% maximum = @documents.map { |d| d.record[field].length }.max %>
              <% maximum.times do |i| %>
                <% subfields.each_with_index do |subfield, j| %>
                  <% values = (0..1).to_a.map { |j| @documents[j].record[field].maybe[i].maybe[subfield] } %>
                  <tr>
                    <%= content_tag(:td, titleize(field), rowspan: subfields.length) if j == 0 %>
                    <td><%= titleize(subfield) %></td>
                    <% 2.times do |j| %>
                      <%= value(values[j]) %>
                    <% end %>
                  </tr>
                <% end %>
              <% end %>
            <% else %>
              <tr>
                <td><%= titleize(field) %></td>
                <td></td>
                <% 2.times do |i| %>
                  <%= value(@documents[i].record[field]) %>
                <% end %>
              </tr>
            <% end %>
          <% end %>
        </tbody>
      </table>
    </div>
  </div>
</div>


<h1>Repositories</h1>
<h2><%= params[:action].titlecase %></h2>
<ul class="dashboard content repository nav nav-pills">
  <li class="active"><a href="#index" data-toggle="pill">Index</a></li>
  <li><a href="#leaderboard" data-toggle="pill">Leaderboard</a></li>
  <li><a href="#map" data-toggle="pill">Map</a></li>
  <li><a href="#timeline" data-toggle="pill">Timeline</a></li>
  <li><a href="#numbers" data-toggle="pill">Numbers</a></li>
</ul>
<div class="dashboard">
  <div class="row">
    <div class="col-md-12 pill-content">
      <div id="index" class="pill-pane active">
        <table class="table table-striped">
          <thead>
            <tr>
              <th>Name</th>
              <th>Type</th>
              <th>Datasets</th>
              <th>URL</th>
            </tr>
          </thead>
          <tbody>
            <% @repositories.each do |repository| %>
              <tr>
                <td><%= link_to repository.name, repository %></td>
                <td><%= repository.type %></td>
                <td><%= count(repository) %></td>
                <td><a href="<%= repository.url %>"><%= repository.url.sub(/^https?\:\/\//, '').sub(/^www./,'') %></a></td>
              </tr>
            <% end %>
          </tbody>
        </table>
      </div>
      <div id="leaderboard" class="pill-pane">
        <table class="repositories leaderboard table table-striped">
          <thead>
            <th>Rank</th>
            <th>Repository</th>
            <th>Score</th>
            <% Metrics.all.each do |metric| %>
              <th><%= metric.to_s.titlecase %></th>
            <% end %>
          </thead>
          <tbody>
            <% @repositories.sort.reverse.each_with_index do |repository, i| %>
              <tr>
                <td><%= i + 1 %></td>
                <td><%= link_to repository.name, repository %></td>
                <td><%= '%.2f' % repository.score %></td>
                <% Metrics.all.each do |metric| %>
                  <% result = repository.snapshots.last.maybe(metric) %>
                  <% score = if result.nil? then nil else result[:average] end %>
                  <td><%= if score.nil? then '?' else '%.2f' % score end %></td>
                  <% end %>
                  <td></td>
                </tr>
              <% end %>
            </tbody>
          </table>
        </div>
        <div id="map" class="pill-pane repositories map"></div>
        <div id="timeline" class="pill-pane"></div>
        <div id="numbers" class="pill-pane">
          <table class="table table-striped table-bordered">
            <thead>
              <tr>
                <th>Repository</th>
                <th>Minimum</th>
                <th>Average</th>
                <th>Median</th>
                <th>Maximum</th>
                <th>Sum</th>
              </tr>
            </thead>
            <tbody>
              <% @numbers.each do |repository, metrics| %>
                <tr>
                  <td><%= repository.name %></td>
                  <td><%= metrics[:min] %></td>
                  <td><%= metrics[:avg].round %></td>
                  <td><%= metrics[:med] %></td>
                  <td><%= metrics[:max] %></td>
                  <td><%= number_with_delimiter metrics[:sum] %></td>
                </tr>
              <% end %>
            </tbody>
          </table>
        </div>
      </div>
    </div>
  </div>
